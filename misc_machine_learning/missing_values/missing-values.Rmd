---
title: "missing_values"
output:
  md_document:
    variant: markdown_github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r cars}
iris_data <- read.table("iris.csv", header = TRUE, sep = ";", dec = ",")
head(iris_data)
plot(iris_data$Petal.Width,iris_data$Petal.Length)
```

Fitting linear model. 

```{r}
lm_fit <- lm(Petal.Width ~ Petal.Length, data = iris_data)
summary(lm_fit)

lm_fit$coefficients
```
Here mean can't be calculated with NA values.
```{r}
mean(iris_data$Petal.Length)
mean(iris_data$Petal.Width)
summary(iris_data)
```

We have set omission as method of dealing with missing values.
I iris data we have 23 complete observations -> no missing values

```{r}
getOption('na.action')
sum(complete.cases(iris_data))
```
with na removal.

```{r}
(mean_pl <- mean(iris_data$Petal.Length, na.rm = TRUE))
(mean_pw <- mean(iris_data$Petal.Width, na.rm = TRUE))

```
No na removal, only complete rows, complete pairwise
```{r}
cov(iris_data$Petal.Length, iris_data$Petal.Width) #returns NA
cov(iris_data$Petal.Length, iris_data$Petal.Width, use = "complete.obs") # case wise deletion
cov(iris_data$Petal.Length, iris_data$Petal.Width, use = "pairwise.complete.obs") # calculated using all pair
```
mean imputation for missing values.

```{r}
mean_imputation <- iris_data

idx_pw_na <- is.na(mean_imputation$Petal.Width) #find na
mean_imputation$Petal.Width[idx_pw_na] <- mean(mean_pw)
mean_pw_meanimpute <- mean(mean_imputation$Petal.Width)

idx_pl_na <- is.na(mean_imputation$Petal.Length) #find na
mean_imputation$Petal.Length[idx_pl_na] <- mean(mean_pl)
mean_pl_meanimpute <- mean(mean_imputation$Petal.Length)
mean_pl_meanimpute
```
stratified mean imputation for missing values.

```{r}

strat_mean_imputation <- iris_data

#petal width
mean_pw_setosa <- mean(subset(iris_data, Species == "setosa")$Petal.Width, na.rm = TRUE)
strat_mean_imputation$Petal.Width[is.na(strat_mean_imputation$Petal.Width) & strat_mean_imputation$Species == "setosa"] <- mean_pw_setosa

mean_pw_virginica <- mean(subset(iris_data, Species == "virginica")$Petal.Width, na.rm = TRUE)
strat_mean_imputation$Petal.Width[is.na(strat_mean_imputation$Petal.Width) & strat_mean_imputation$Species == "virginica"] <- mean_pw_virginica

mean_pw_versicolor <- mean(subset(iris_data, Species == "versicolor")$Petal.Width, na.rm = TRUE)
strat_mean_imputation$Petal.Width[is.na(strat_mean_imputation$Petal.Width) & strat_mean_imputation$Species == "versicolor"] <- mean_pw_versicolor

summary(strat_mean_imputation)
mean_pw_strat <- mean(strat_mean_imputation$Petal.Width)

#petal length
mean_pl_virginica <- mean(subset(iris_data, Species == "virginica")$Petal.Length, na.rm = TRUE)
strat_mean_imputation$Petal.Length[is.na(strat_mean_imputation$Petal.Length) & strat_mean_imputation$Species == "virginica"] <- mean_pl_virginica

summary(strat_mean_imputation)
mean_pl_strat <-  mean(strat_mean_imputation$Petal.Length)
mean_pl_strat
```
regression imputation for na values.

```{r}

regr_imputation <- iris_data
summary(regr_imputation)

#petal width
subset(regr_imputation,is.na(Petal.Width))

# fit the linear model and impute predictions

lm_fit_width <- lm(Petal.Width ~ Petal.Length, data = iris_data)
regr_imputation$Petal.Width[is.na(regr_imputation$Petal.Width)] <- predict(lm_fit_width, subset(regr_imputation, is.na(Petal.Width)))

mean_pw_regr <- mean(regr_imputation$Petal.Width)
mean_pw_regr

#petal length
subset(regr_imputation,is.na(Petal.Length))
       
lm_fit_length <- lm(Petal.Length ~ Petal.Width, data = iris_data)
regr_imputation$Petal.Length[is.na(regr_imputation$Petal.Length)] <- predict(lm_fit_length, subset(regr_imputation, is.na(Petal.Length)))  
summary(regr_imputation)

mean_pl_regr <- mean(regr_imputation$Petal.Length)
mean_pl_regr
```

maximum likelihood for na values.

```{r}

if (!require(mclust)) {
  install.packages("mclust")
  require(mclust)
}
iris_ml <- iris_data
trainingdata <- iris_data[complete.cases(iris_data),]

dens <- densityMclust(trainingdata[,c(1,2)])
summary(dens, parameters = TRUE)

#plot(dens, what = "density", data = trainingdata[,c(1,2)])
#plot(dens, what = "density", type = "persp")

summary(iris_ml)

#width estimates 
widths <- seq(0,4,0.1)

lengths <- rep(iris_data$Petal.Length[18], length(widths))
ml_est <- seq(0,4,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Width[18] <- ml_est

lengths <- rep(iris_data$Petal.Length[3], length(widths))
ml_est <- seq(0,4,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Width[3] <- ml_est

iris_ml
mean_pw_ml <- mean(iris_ml$Petal.Width)
mean_pw_ml

#Length estimates
lengths <- seq(1,7,0.1)

widths <- rep(iris_data$Petal.Width[21], length(lengths))
ml_est <- seq(1,7,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Length[21] <- ml_est

widths <- rep(iris_data$Petal.Width[22], length(lengths))
ml_est <- seq(1,7,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Length[22] <- ml_est

widths <- rep(iris_data$Petal.Width[26], length(lengths))
ml_est <- seq(1,7,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Length[26] <- ml_est

widths <- rep(iris_data$Petal.Width[27], length(lengths))
ml_est <- seq(1,7,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Length[27] <- ml_est

widths <- rep(iris_data$Petal.Width[28], length(lengths))
ml_est <- seq(1,7,0.1)[which.max(predict(dens, data.frame(Petal.Length = lengths, Petal.Width = widths)))]
iris_ml$Petal.Length[28] <- ml_est

iris_ml
mean_pl_ml <- mean(iris_ml$Petal.Length)
mean_pl_ml

```




